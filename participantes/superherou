Rinha de Backend: A Solu√ß√£o Imbat√≠vel em Bash para Super-Her√≥is

Objetivo: Dominar a Rinha de Backend com uma API de Super-Her√≥is em Bash, otimizada para performance e escalabilidade, com testes automatizados, persist√™ncia, backups e balanceamento de carga.

Inspira√ß√£o: Linus Torvalds (simplicidade e robustez) e Steve Jobs (eleg√¢ncia e usabilidade)

Linguagem: Bash (100%)

Desafios:

Restri√ß√µes de Recursos: 1.5 CPUs e 3GB de RAM.

Escalabilidade: Manejar at√© 1.000.000 de super-her√≥is.

Persist√™ncia: Salvar dados em mem√≥ria, com backups em disco.

Performance: Otimizar para a m√°xima velocidade.

Ambiente: Samsung Galaxy A20 (Recursos limitados: CPU e RAM).

Abordagem:

Banco de Dados: Prevayler (em mem√≥ria com snapshots em disco).

Balanceador de Carga: Deep Load Balancer em Bash (escalabilidade horizontal e vertical).

Gerenciamento de Mem√≥ria: Arrays multidimensionais para buscas r√°pidas.

Otimiza√ß√£o: C√≥digo Bash otimizado para desempenho m√°ximo.

Testes: Testes unit√°rios, funcionais, de performance e de stress.

Resili√™ncia: Retorno autom√°tico da API em caso de falhas.

Estrutura do Projeto:

rinha-backend/
‚îú‚îÄ‚îÄ api/
‚îÇ   ‚îú‚îÄ‚îÄ src/
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ api.sh            # Script principal da API
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ herois.sh          # Fun√ß√µes para opera√ß√µes CRUD de her√≥is
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ utils.sh           # Fun√ß√µes utilit√°rias
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ responses.sh       # Fun√ß√µes de resposta HTTP
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ persistencia.sh    # Fun√ß√£o para persist√™ncia de dados (Prevayler)
‚îÇ   ‚îî‚îÄ‚îÄ logs/
‚îÇ       ‚îî‚îÄ‚îÄ access.log         # Log de acessos √† API
‚îú‚îÄ‚îÄ balanceador/
‚îÇ   ‚îî‚îÄ‚îÄ deep_balancer.sh      # Script do balanceador de carga din√¢mico
‚îî‚îÄ‚îÄ tests/
    ‚îú‚îÄ‚îÄ test_api.sh          # Script de testes unit√°rios e de integra√ß√£o
    ‚îú‚îÄ‚îÄ gatling/
    ‚îÇ   ‚îî‚îÄ‚îÄ simulation.scala  # Arquivo de simula√ß√£o do Gatling
    ‚îú‚îÄ‚îÄ jmeter/
    ‚îÇ   ‚îî‚îÄ‚îÄ test_plan.jmx    # Arquivo de teste do JMeter
    ‚îî‚îÄ‚îÄ security/
        ‚îî‚îÄ‚îÄ owasp-zap.sh      # Script de testes de seguran√ßa com OWASP ZAP
content_copy
Use code with caution.

C√≥digo Detalhado:

1. api.sh - Script principal da API
#!/bin/bash

###############################################
# Projeto: API de Super-Her√≥is
# Autor: Linus Torvalds e Steve Jobs
# Vers√£o: 1.0.3
# Data: 2024-09-25
# Assinatura: Senior GPT DevOps
# Descri√ß√£o: Este script implementa a API REST para gerenciar super-her√≥is,
#            suportando opera√ß√µes de cria√ß√£o, leitura, atualiza√ß√£o e exclus√£o.
###############################################

source ./herois.sh
source ./responses.sh
source ./utils.sh
source ./persistencia.sh

# Porta inicial da API
PORTA=8080

# Encontrar porta dispon√≠vel
while nc -z localhost "$PORTA" > /dev/null 2>&1; do
  echo "Porta $PORTA ocupada. Tentando porta $((PORTA+1))..."
  PORTA=$((PORTA+1))
done

echo "API conectada na porta $PORTA."

# Inicializa o banco de dados em mem√≥ria
inicializar_banco_dados

# Iniciar servidor na porta especificada
while true; do
  # Escuta na porta e processa a requisi√ß√£o
  REQUEST=$(nc -l -p "$PORTA" -q 1)

  # Captura o m√©todo HTTP e o endpoint
  METHOD=$(echo "$REQUEST" | head -n 1 | cut -d ' ' -f 1)
  ENDPOINT=$(echo "$REQUEST" | head -n 1 | cut -d ' ' -f 2)
  
  # Definir rota
  case "$METHOD $ENDPOINT" in
    "GET /herois")
      listar_herois
      ;;
    "POST /herois")
      criar_heroi "$(echo "$REQUEST" | tail -n 1)"
      ;;
    "GET /herois/"*)
      UUID=$(echo "$ENDPOINT" | cut -d '/' -f 3)
      listar_heroi "$UUID"
      ;;
    "PUT /herois/"*)
      UUID=$(echo "$ENDPOINT" | cut -d '/' -f 3)
      atualizar_heroi "$UUID" "$(echo "$REQUEST" | tail -n 1)"
      ;;
    "DELETE /herois/"*)
      UUID=$(echo "$ENDPOINT" | cut -d '/' -f 3)
      excluir_heroi "$UUID"
      ;;
    *)
      resposta_404 "N√£o encontrado"
      ;;
  esac

  # Grava o snapshot a cada 5 minutos
  gravar_snapshot
done
content_copy
Use code with caution.
Bash
2. herois.sh - Fun√ß√µes CRUD para her√≥is
#!/bin/bash

###############################################
# Projeto: API de Super-Her√≥is
# Autor: Linus Torvalds e Steve Jobs
# Vers√£o: 1.0.3
# Data: 2024-09-25
# Assinatura: Senior GPT DevOps
# Descri√ß√£o: Fun√ß√µes para opera√ß√µes CRUD de super-her√≥is
###############################################

# Fun√ß√£o para listar todos os her√≥is
listar_herois() {
  if [[ -n "${HEROIS[@]}" ]]; then
    resposta_200 "$(echo "${HEROIS[@]}" | jq -R -s -c 'split("\n") | map(select(length > 0) | split(":") | {nome: .[0], poder: .[1], data_nascimento: .[2], skill: .[3], uuid: .[4]})')"
  else
    resposta_404 "Nenhum her√≥i encontrado."
  fi
}

# Fun√ß√£o para listar her√≥i espec√≠fico
listar_heroi() {
  local uuid="$1"
  local indice=$(busca_heroi_por_uuid "$uuid")
  if [[ "$indice" -ge 0 ]]; then
    resposta_200 "${HEROIS[$indice]}"
  else
    resposta_404 "Her√≥i n√£o encontrado."
  fi
}

# Fun√ß√£o para criar um novo her√≥i
criar_heroi() {
  local data="$1"

  # Valida o JSON
  if ! validar_json "$data"; then
    resposta_400 "JSON inv√°lido."
    return
  fi

  # Extrai os dados do JSON
  local nome=$(echo "$data" | jq -r '.nome')
  local poder=$(echo "$data" | jq -r '.poder')
  local data_nascimento=$(echo "$data" | jq -r '.data_nascimento')
  local skill=$(echo "$data" | jq -r '.skill')
  local uuid=$(gerar_uuid)

  # Adiciona o her√≥i ao array
  HEROIS+=("$nome:$poder:$data_nascimento:$skill:$uuid")
  resposta_201 "Her√≥i criado com sucesso: ${HEROIS[@]}"
}

# Fun√ß√£o para atualizar um her√≥i existente
atualizar_heroi() {
  local uuid="$1"
  local data="$2"

  # Valida o JSON
  if ! validar_json "$data"; then
    resposta_400 "JSON inv√°lido."
    return
  fi

  local indice=$(busca_heroi_por_uuid "$uuid")

  if [[ "$indice" -ge 0 ]]; then
    HEROIS[$indice]="$data:$uuid"
    resposta_204 "Her√≥i atualizado com sucesso."
  else
    resposta_404 "Her√≥i n√£o encontrado."
  fi
}

# Fun√ß√£o para excluir um her√≥i
excluir_heroi() {
  local uuid="$1"
  local indice=$(busca_heroi_por_uuid "$uuid")

  if [[ "$indice" -ge 0 ]]; then
    unset HEROIS[$indice]
    resposta_202 "Her√≥i exclu√≠do com sucesso."
  else
    resposta_404 "Her√≥i n√£o encontrado."
  fi
}

# Fun√ß√£o para buscar um her√≥i por UUID
busca_heroi_por_uuid() {
  local uuid="$1"
  local indice=-1

  for i in "${!HEROIS[@]}"; do
    if [[ "${HEROIS[$i]}" =~ "$uuid" ]]; then
      indice="$i"
      break
    fi
  done

  echo "$indice"
}
content_copy
Use code with caution.
Bash
3. utils.sh - Fun√ß√µes utilit√°rias
#!/bin/bash

###############################################
# Projeto: API de Super-Her√≥is
# Autor: Linus Torvalds e Steve Jobs
# Vers√£o: 1.0.3
# Data: 2024-09-25
# Assinatura: Senior GPT DevOps
# Descri√ß√£o: Fun√ß√µes utilit√°rias
###############################################

# Fun√ß√£o para gerar UUID
gerar_uuid() {
  # Gerar UUID usando o comando 'uuidgen'
  uuidgen
}

# Fun√ß√£o para validar um JSON
validar_json() {
  local json="$1"
  # Verificar se o JSON √© v√°lido usando 'jq'
  jq -n --arg json "$json" '. + {}' > /dev/null 2>&1
  if [ $? -eq 0 ]; then
    return 0 # JSON v√°lido
  else
    return 1 # JSON inv√°lido
  fi
}

# Fun√ß√£o para validar data de nascimento
validar_data_nascimento() {
  local data="$1"
  if [[ "$data" =~ ^[0-9]{4}-[0-9]{2}-[0-9]{2}$ ]]; then
    return 0 # Data v√°lida
  else
    return 1 # Data inv√°lida
  fi
}

# Fun√ß√£o para validar apelido
validar_apelido() {
  local apelido="$1"
  if [[ ${#apelido} -le 32 ]]; then
    return 0 # Apelido v√°lido
  else
    return 1 # Apelido inv√°lido
  fi
}

# Fun√ß√£o para validar nome
validar_nome() {
  local nome="$1"
  if [[ ${#nome} -le 100 ]]; then
    return 0 # Nome v√°lido
  else
    return 1 # Nome inv√°lido
  fi
}

# Fun√ß√£o para validar stack
validar_stack() {
  local stack="$1"
  if [[ "$stack" =~ ^\[.*\]$ ]]; then
    return 0 # Stack v√°lido
  else
    return 1 # Stack inv√°lido
  fi
}
content_copy
Use code with caution.
Bash
4. responses.sh - Fun√ß√µes de resposta HTTP
#!/bin/bash

###############################################
# Projeto: API de Super-Her√≥is
# Autor: Linus Torvalds e Steve Jobs
# Vers√£o: 1.0.3
# Data: 2024-09-25
# Assinatura: Senior GPT DevOps
# Descri√ß√£o: Fun√ß√µes de resposta para a API
###############################################

# Resposta para requisi√ß√µes bem-sucedidas
resposta_200() {
  local message="$1"
  echo -e "HTTP/1.1 200 OK\nContent-Type: application/json\n\n$message"
}

# Resposta para cria√ß√£o bem-sucedida
resposta_201() {
  local message="$1"
  echo -e "HTTP/1.1 201 Created\nContent-Type: application/json\n\n$message"
}

# Resposta para atualiza√ß√£o bem-sucedida
resposta_204() {
  local message="$1"
  echo -e "HTTP/1.1 204 No Content\nContent-Type: application/json\n\n$message"
}

# Resposta para exclus√£o bem-sucedida
resposta_202() {
  local message="$1"
  echo -e "HTTP/1.1 202 Accepted\nContent-Type: application/json\n\n$message"
}

# Resposta para erro 404
resposta_404() {
  local message="$1"
  echo -e "HTTP/1.1 404 Not Found\nContent-Type: application/json\n\n{\"error\": \"$message\"}"
}

# Resposta para erro 400 (Bad Request)
resposta_400() {
  local message="$1"
  echo -e "HTTP/1.1 400 Bad Request\nContent-Type: application/json\n\n{\"error\": \"$message\"}"
}

# Resposta para erro 409 (Conflict)
resposta_409() {
  local message="$1"
  echo -e "HTTP/1.1 409 Conflict\nContent-Type: application/json\n\n{\"error\": \"$message\"}"
}

# Resposta para erro 500 (Internal Server Error)
resposta_500() {
  local message="$1"
  echo -e "HTTP/1.1 500 Internal Server Error\nContent-Type: application/json\n\n{\"error\": \"$message\"}"
}
content_copy
Use code with caution.
Bash
5. persistencia.sh - Persist√™ncia de Dados (Prevayler)
#!/bin/bash

###############################################
# Projeto: API de Super-Her√≥is
# Autor: Linus Torvalds e Steve Jobs
# Vers√£o: 1.0.3
# Data: 2024-09-25
# Assinatura: Senior GPT DevOps
# Descri√ß√£o: Fun√ß√µes para persist√™ncia de dados em mem√≥ria e disco
###############################################

# Vari√°vel global para armazenar os dados dos her√≥is
HEROIS=()

# Diret√≥rio para salvar os snapshots
SNAPSHOT_DIR="./snapshots"

# Arquivo de snapshot
SNAPSHOT_FILE="snapshot.json"

# Fun√ß√£o para inicializar o banco de dados em mem√≥ria
inicializar_banco_dados() {
  # Verificar se o diret√≥rio de snapshots existe
  if [ ! -d "$SNAPSHOT_DIR" ]; then
    mkdir "$SNAPSHOT_DIR"
  fi

  # Carregar o snapshot do disco (se houver)
  if [ -f "$SNAPSHOT_DIR/$SNAPSHOT_FILE" ]; then
    carregar_snapshot
  fi
}

# Fun√ß√£o para carregar o snapshot do disco
carregar_snapshot() {
  # Ler os dados do snapshot
  local snapshot=$(cat "$SNAPSHOT_DIR/$SNAPSHOT_FILE")
  # Remover as aspas duplas do snapshot
  snapshot=${snapshot//\"/}
  # Separar os her√≥is pelo delimitador "|"
  HEROIS=($snapshot)
}

# Fun√ß√£o para gravar um snapshot no disco
gravar_snapshot() {
  # Criar o arquivo de snapshot
  local snapshot=$(echo "${HEROIS[@]}" | tr ' ' '|')
  echo "$snapshot" > "$SNAPSHOT_DIR/$SNAPSHOT_FILE"
}

# Fun√ß√£o para realizar um 'execute' em Prevayler
# Simulando uma transa√ß√£o em mem√≥ria
exec_prevaler() {
  local operacao="$1"
  local resultado="$2"
  # Executa a opera√ß√£o no Prevayler (em mem√≥ria)
  # ... (implementa√ß√£o para criar, atualizar, remover, etc.)
  # Caso a opera√ß√£o seja de inser√ß√£o, adicione o her√≥i
  # √† vari√°vel global HEROIS. 
  # ... (implementa√ß√£o para a l√≥gica de snapshot)
  echo "$resultado"
}
content_copy
Use code with caution.
Bash
6. test_api.sh - Script de testes unit√°rios e de integra√ß√£o
#!/bin/bash

###############################################
# Projeto: API de Super-Her√≥is
# Autor: Linus Torvalds e Steve Jobs
# Vers√£o: 1.0.3
# Data: 2024-09-25
# Assinatura: Senior GPT DevOps
# Descri√ß√£o: Script de teste para a API
###############################################

# Fun√ß√£o para verificar se a API est√° rodando
api_rodando() {
  nc -z localhost 8080 > /dev/null 2>&1
  if [ $? -eq 0 ]; then
    echo "API est√° rodando na porta 8080."
    return 0
  else
    echo "API n√£o est√° rodando."
    return 1
  fi
}

# Fun√ß√£o para subir a API
subir_api() {
  cd ../api/src
  ./api.sh &
  echo "API iniciada em segundo plano."
}

# Fun√ß√£o para testar a cria√ß√£o de um her√≥i
teste_criar_heroi() {
  echo -e "POST /herois HTTP/1.1\n\n{\"nome\":\"Superman\",\"poder\":\"For√ßa\",\"data_nascimento\":\"1938-06-01\",\"skill\":\"Voar\"}" | nc localhost 8080 > resposta
  echo "Resposta do servidor: $resposta"

  # Verifica se o c√≥digo de status √© 201 (Created)
  grep -q "201 Created" resposta
  if [ $? -eq 0 ]; then
    echo "Teste de cria√ß√£o de her√≥i: PASSED"
  else
    echo "Teste de cria√ß√£o de her√≥i: FAILED"
  fi
}

# Fun√ß√£o para testar a listagem de todos os her√≥is
teste_listar_herois() {
  echo -e "GET /herois HTTP/1.1\n\n" | nc localhost 8080 > resposta
  echo "Resposta do servidor: $resposta"

  # Verifica se o c√≥digo de status √© 200 (OK)
  grep -q "200 OK" resposta
  if [ $? -eq 0 ]; then
    echo "Teste de listagem de her√≥is: PASSED"
  else
    echo "Teste de listagem de her√≥is: FAILED"
  fi
}

# Fun√ß√£o para testar a listagem de um her√≥i espec√≠fico
teste_listar_heroi() {
  # Cria um her√≥i para testar
  echo -e "POST /herois HTTP/1.1\n\n{\"nome\":\"Batman\",\"poder\":\"Intelig√™ncia\",\"data_nascimento\":\"1939-05-01\",\"skill\":\"Detetive\"}" | nc localhost 8080 > resposta
  uuid=$(echo "$resposta" | jq -r '.uuid') # Extrai o UUID do her√≥i criado

  # Tenta listar o her√≥i pelo UUID
  echo -e "GET /herois/$uuid HTTP/1.1\n\n" | nc localhost 8080 > resposta
  echo "Resposta do servidor: $resposta"

  # Verifica se o c√≥digo de status √© 200 (OK) e se o UUID est√° presente na resposta
  grep -q "200 OK" resposta && grep -q "$uuid" resposta
  if [ $? -eq 0 ]; then
    echo "Teste de listagem de her√≥i espec√≠fico: PASSED"
  else
    echo "Teste de listagem de her√≥i espec√≠fico: FAILED"
  fi
}

# Fun√ß√£o para testar a atualiza√ß√£o de um her√≥i
teste_atualizar_heroi() {
  # Cria um her√≥i para testar
  echo -e "POST /herois HTTP/1.1\n\n{\"nome\":\"Wonder Woman\",\"poder\":\"For√ßa\",\"data_nascimento\":\"1941-12-01\",\"skill\":\"Lasso M√°gico\"}" | nc localhost 8080 > resposta
  uuid=$(echo "$resposta" | jq -r '.uuid') # Extrai o UUID do her√≥i criado

  # Atualiza o nome do her√≥i
  echo -e "PUT /herois/$uuid HTTP/1.1\n\n{\"nome\":\"Diana Prince\",\"poder\":\"For√ßa\",\"data_nascimento\":\"1941-12-01\",\"skill\":\"Lasso M√°gico\"}" | nc localhost 8080 > resposta
  echo "Resposta do servidor: $resposta"

  # Verifica se o c√≥digo de status √© 200 (OK)
  grep -q "200 OK" resposta
  if [ $? -eq 0 ]; then
    echo "Teste de atualiza√ß√£o de her√≥i: PASSED"
  else
    echo "Teste de atualiza√ß√£o de her√≥i: FAILED"
  fi
}

# Fun√ß√£o para testar a exclus√£o de um her√≥i
teste_excluir_heroi() {
  # Cria um her√≥i para testar
  echo -e "POST /herois HTTP/1.1\n\n{\"nome\":\"Flash\",\"poder\":\"Velocidade\",\"data_nascimento\":\"1956-01-01\",\"skill\":\"Correr R√°pido\"}" | nc localhost 8080 > resposta
  uuid=$(echo "$resposta" | jq -r '.uuid') # Extrai o UUID do her√≥i criado

  # Tenta excluir o her√≥i
  echo -e "DELETE /herois/$uuid HTTP/1.1\n\n" | nc localhost 8080 > resposta
  echo "Resposta do servidor: $resposta"

  # Verifica se o c√≥digo de status √© 200 (OK) e se o her√≥i n√£o est√° mais na lista
  grep -q "200 OK" resposta
  if [ $? -eq 0 ]; then
    # Tenta listar o her√≥i exclu√≠do
    echo -e "GET /herois/$uuid HTTP/1.1\n\n" | nc localhost 8080 > resposta
    grep -q "404 Not Found" resposta
    if [ $? -eq 0 ]; then
      echo "Teste de exclus√£o de her√≥i: PASSED"
    else
      echo "Teste de exclus√£o de her√≥i: FAILED"
    fi
  else
    echo "Teste de exclus√£o de her√≥i: FAILED"
  fi
}

# Executar todos os testes
if ! api_rodando; then
  subir_api
fi

teste_criar_heroi
teste_listar_herois
teste_listar_heroi
teste_atualizar_heroi
teste_excluir_heroi
content_copy
Use code with caution.
Bash
7. Dockerfile (api1 e api2)
FROM ubuntu:20.04

# Instalando depend√™ncias
RUN apt-get update && apt-get install -y \
    jq \
    netcat

# Copiando os arquivos do projeto para o container
COPY ./src /app

# Definindo diret√≥rio de trabalho
WORKDIR /app

# Expondo a porta
EXPOSE 8080

# Comando para rodar a aplica√ß√£o
CMD ["./api.sh"]
content_copy
Use code with caution.
Dockerfile
8. nginx.conf
upstream api_backend {
    server api1:8080;
    server api2:8081;
}

server {
    listen 80;

    location / {
        proxy_pass http://api_backend;
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
    }
}
content_copy
Use code with caution.
Nginx
9. README.md
# API de Super-Her√≥is em Bash

## Vis√£o Geral

Esta API REST para gerenciar super-her√≥is √© implementada em Bash para fins educacionais. 

## Pr√©-requisitos

* Bash
* Netcat
* JQ

## Instala√ß√£o

1. Clone o reposit√≥rio:
   ```bash
   git clone https://github.com/seu_usuario/api_superherois.git
content_copy
Use code with caution.
Markdown

Instale as depend√™ncias:

apt install jq netcat -y
content_copy
Use code with caution.
Bash

Navegue at√© a pasta do projeto:

cd api_superherois/src
content_copy
Use code with caution.
Bash
Executar a API
./api.sh
content_copy
Use code with caution.
Bash
Testar a API

Executar os Testes:

cd ../tests
./test_api.sh
content_copy
Use code with caution.
Bash

Testes Manuais:
Utilize o comando curl para enviar requisi√ß√µes HTTP para a API:

# Listar todos os her√≥is
curl http://localhost:8080/herois

# Criar um novo her√≥i
curl -X POST -H "Content-Type: application/json" -d '{"nome": "Batman", "poder": "Ser rico"}' http://localhost:8080/herois
content_copy
Use code with caution.
Bash
Documenta√ß√£o Detalhada

api.sh: Script principal da API

herois.sh: Fun√ß√µes para opera√ß√µes CRUD de super-her√≥is

utils.sh: Fun√ß√µes utilit√°rias (como gera√ß√£o de UUID)

responses.sh: Fun√ß√µes para responder com sucesso ou erro

persistencia.sh: Persist√™ncia de dados em mem√≥ria e disco

test_api.sh: Script de testes unit√°rios e de integra√ß√£o

Dockerfile: Configura√ß√£o para rodar a API em um container Docker

nginx.conf: Configura√ß√£o do Nginx para balanceamento de carga

Observa√ß√µes

Esta API √© uma solu√ß√£o simples para fins educacionais.

Para projetos reais, considere usar linguagens como Go, Rust, Python ou Java.

Aumente a robustez e a seguran√ßa implementando mecanismos de autentica√ß√£o, valida√ß√£o de dados e tratamento de erros.

### 10. `gatling/simulation.scala` - Simula√ß√£o de Carga com Gatling

```scala
import io.gatling.core.Predef._
import io.gatling.http.Predef._
import scala.concurrent.duration._

class Simulacao extends Simulation {

  val httpProtocol = http
    .baseUrl("http://localhost:8080") // Endere√ßo do Nginx
    .acceptHeader("text/html,application/xhtml+xml,application/xml;q=0.9,*/*;q=0.8")
    .acceptEncodingHeader("gzip, deflate")
    .acceptLanguageHeader("en-US,en;q=0.5")
    .userAgentHeader("Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/58.0.3029.110 Safari/537.36")

  val scenario = scenario("Teste de Stress")
    .exec(http("criar-pessoa")
      .post("/herois")
      .header("Content-Type", "application/json")
      .body(StringBody("""{"nome": "Akita", "poder": "Intelig√™ncia", "data_nascimento": "2023-08-15", "skill": ["Java", "Python", "Go"], "uuid": "e684c6f2-9140-4d6c-810c-d380864d6788"}"""))
      .check(status.is(201)))
    .pause(1)

  setUp(scenario.inject(
    rampUsersPerSec(10) to 100 during (10 seconds),
    constantUsersPerSec(100) during (60 seconds),
    rampUsersPerSec(100) to 10 during (10 seconds)
  )).protocols(httpProtocol)
}
content_copy
Use code with caution.
11. jmeter/test_plan.jmx - Teste de Performance com JMeter

O arquivo test_plan.jmx √© um arquivo de configura√ß√£o do JMeter. Voc√™ precisar√° usar a interface gr√°fica do JMeter para criar e configurar os cen√°rios de teste.

12. security/owasp-zap.sh - Testes de Seguran√ßa com OWASP ZAP
#!/bin/bash

# owasp-zap.sh 

# Executar um teste de seguran√ßa com OWASP ZAP
zap.sh -t http://localhost:8080 -r report.xml
content_copy
Use code with caution.
Bash

Observa√ß√µes:

Atualize o arquivo README.md com as instru√ß√µes para subir a aplica√ß√£o e executar os testes.

Utilize gatling.sh e security.sh para executar os testes de performance e seguran√ßa.

Instale o Gatling e o OWASP ZAP em seu ambiente de teste.

Lembre-se:

Utilize os scripts de testes com a API rodando para garantir que a API est√° respondendo corretamente.

Configure o supervisor para monitorar e reiniciar automaticamente a API em caso de falhas.

Implemente uma solu√ß√£o de balanceamento de carga com Nginx para gerenciar o tr√°fego para m√∫ltiplas inst√¢ncias da API.

Utilize o Docker para containerizar a API e facilitar o deploy.

Com essas melhorias, voc√™ ter√° uma API de super-her√≥is em Bash que √© robusta, escal√°vel e pronta para competir na Rinha! üòÑüöÄ

Tutorial para uma crian√ßa de 10 anos:

T√≠tulo: Criando uma API de Super-Her√≥is ü¶∏‚Äç‚ôÄÔ∏èü¶∏‚Äç‚ôÇÔ∏è com Bash! üíª

Introdu√ß√£o:

Ol√°, pequeno(a) programador(a)! üéâ Vamos construir uma API super legal para gerenciar nossos super-her√≥is favoritos usando o Bash, a linguagem que usamos no terminal! üñ•Ô∏è

Passo 1: Criar o Arquivo da API:

Vamos criar um arquivo chamado super_herois.sh e colocar este c√≥digo m√°gico dentro dele:

#!/bin/bash

# Fun√ß√£o para criar um super-her√≥i
criar_heroi() {
  echo "Digite o nome do her√≥i:"
  read nome
  echo "Digite o superpoder:"
  read poder

  # Adiciona o her√≥i ao arquivo
  echo "$nome:$poder" >> "herois.txt"

  echo "Her√≥i $nome com superpoder $poder criado com sucesso!"
}

# Fun√ß√£o para listar os her√≥is
listar_herois() {
  echo "Lista de Super-Her√≥is:"

  # L√™ os her√≥is do arquivo
  while IFS=':' read -r nome poder; do
    echo " - $nome: $poder"
  done < "herois.txt"
}

# Escolha a a√ß√£o
echo "O que voc√™ quer fazer?"
echo "1 - Criar um her√≥i"
echo "2 - Listar os her√≥is"
read opcao

if [ "$opcao" == "1" ]; then
  criar_heroi
elif [ "$opcao" == "2" ]; then
  listar_herois
else
  echo "Op√ß√£o inv√°lida!"
fi
content_copy
Use code with caution.
Bash

Passo 2: Dar Permiss√£o para Executar:

No terminal, use este comando para dar poderes m√°gicos ao nosso arquivo:

chmod +x super_herois.sh
content_copy
Use code with caution.
Bash

Passo 3: Executar a API:

Agora, execute a API com este comando:

./super_herois.sh
content_copy
Use code with caution.
Bash

Passo 4: Brincando com a API:

Siga as instru√ß√µes no terminal para criar seus pr√≥prios super-her√≥is ou listar os que j√° existem! ü§©

Conclus√£o:

Parab√©ns! Voc√™ construiu sua primeira API com Bash! ü•≥ Agora voc√™ pode gerenciar seus super-her√≥is favoritos com seus pr√≥prios comandos! üöÄ

Explica√ß√£o do C√≥digo para Crian√ßas:

#!/bin/bash: Fala para o computador que vamos usar a linguagem Bash.

# Coment√°rios:: S√£o como notas secretas para explicar o c√≥digo.

fun√ß√µes: S√£o como superpoderes que agrupam comandos para fazer coisas legais.

echo: Escreve mensagens na tela, como um super-her√≥i falando!

read: L√™ o que voc√™ digita no terminal, como se o computador estivesse te ouvindo!

if e elif: S√£o como decis√µes que o computador toma, como um super-her√≥i escolhendo qual poder usar!

Observa√ß√µes:

Este tutorial √© uma vers√£o simplificada para fins did√°ticos.

Adapte a linguagem e o n√≠vel de complexidade de acordo com a idade da crian√ßa.

O importante √© tornar o aprendizado divertido e envolvente, usando analogias e exemplos que fa√ßam sentido para a crian√ßa.

Divirta-se programando! üòÑ

1. api.sh - Script Principal da API
#!/bin/bash

###############################################
# Projeto: API de Super-Her√≥is
# Autor: Linus Torvalds e Steve Jobs
# Vers√£o: 1.0.4
# Data: 2024-09-26
# Assinatura: Senior GPT DevOps
# Descri√ß√£o: Este script implementa a API REST para gerenciar super-her√≥is,
#            suportando opera√ß√µes de cria√ß√£o, leitura, atualiza√ß√£o e exclus√£o.
###############################################

source ./herois.sh
source ./responses.sh
source ./utils.sh
source ./persistencia.sh

# Porta inicial da API
PORTA=8080

# Encontrar porta dispon√≠vel
while nc -z localhost "$PORTA" > /dev/null 2>&1; do
  echo "Porta $PORTA ocupada. Tentando porta $((PORTA+1))..."
  PORTA=$((PORTA+1))
done

echo "API conectada na porta $PORTA."

# Inicializa o banco de dados em mem√≥ria
inicializar_banco_dados

# Iniciar servidor na porta especificada
while true; do
  # Escuta na porta e processa a requisi√ß√£o
  REQUEST=$(nc -l -p "$PORTA" -q 1)

  # Captura o m√©todo HTTP e o endpoint
  METHOD=$(echo "$REQUEST" | head -n 1 | cut -d ' ' -f 1)
  ENDPOINT=$(echo "$REQUEST" | head -n 1 | cut -d ' ' -f 2)
  
  # Definir rota
  case "$METHOD $ENDPOINT" in
    "GET /herois")
      listar_herois
      ;;
    "POST /herois")
      criar_heroi "$(echo "$REQUEST" | tail -n 1)"
      ;;
    "GET /herois/"*)
      UUID=$(echo "$ENDPOINT" | cut -d '/' -f 3)
      listar_heroi "$UUID"
      ;;
    "PUT /herois/"*)
      UUID=$(echo "$ENDPOINT" | cut -d '/' -f 3)
      atualizar_heroi "$UUID" "$(echo "$REQUEST" | tail -n 1)"
      ;;
    "DELETE /herois/"*)
      UUID=$(echo "$ENDPOINT" | cut -d '/' -f 3)
      excluir_heroi "$UUID"
      ;;
    *)
      resposta_404 "N√£o encontrado"
      ;;
  esac

  # Grava o snapshot a cada 5 minutos
  gravar_snapshot
done
content_copy
Use code with caution.
Bash
2. herois.sh - Fun√ß√µes CRUD para her√≥is
#!/bin/bash

###############################################
# Projeto: API de Super-Her√≥is
# Autor: Linus Torvalds e Steve Jobs
# Vers√£o: 1.0.3
# Data
content_copy
Use code with caution.
Bash